import { useState } from "react";

const screens = [
  {
    id: "onboarding",
    label: "ì˜¨ë³´ë”©",
    icon: "ğŸš€",
    color: "#4f80ff",
    desc: "í”„ë¡œì íŠ¸ ë“±ë¡ & ê³„ì•½ ë²”ìœ„ ì„¤ì •",
    steps: ["ì—ì´ì „ì‹œ ì •ë³´ ì…ë ¥", "í”„ë¡œì íŠ¸ ìƒì„±", "ê³„ì•½ì„œ ê¸°ë°˜ ë²”ìœ„ ì •ì˜", "íŒ€ì› ì´ˆëŒ€"],
  },
  {
    id: "daily",
    label: "ì¼ì¼ ì…ë ¥",
    icon: "â±",
    color: "#a855f7",
    desc: "3ë²„íŠ¼ Â· 1ë¶„ ê³¼ì—… ë³€ê²½ ì´ë ¥ ê¸°ë¡",
    steps: ["ì˜¤ëŠ˜ì˜ ìš”ì²­ ìˆ˜ì‹  ì—¬ë¶€", "ë²”ìœ„ ë‚´ / ë²”ìœ„ ì™¸ / ë³´ë¥˜ ì„ íƒ", "ë©”ëª¨ ì…ë ¥ (ì„ íƒ)", "ì´ë ¥ ìë™ ëˆ„ì "],
  },
  {
    id: "analysis",
    label: "AI íŒì •",
    icon: "ğŸ¤–",
    color: "#06b6d4",
    desc: "ì‹œìŠ¤í…œì´ ë²”ìœ„ ì´ˆê³¼ ì—¬ë¶€ë¥¼ íŒì •",
    steps: ["ìš”ì²­ ë‚´ìš© AI ë¶„ì„", "ê³„ì•½ ë²”ìœ„ì™€ ëŒ€ì¡°", "ì´ˆê³¼ ì—¬ë¶€ íŒì • ê²°ê³¼ ìƒì„±", "ê·¼ê±° ë¬¸ì„œ ìë™ ì‘ì„±"],
  },
  {
    id: "report",
    label: "ë²”ìœ„ ì´ˆê³¼ ë¦¬í¬íŠ¸",
    icon: "ğŸ“„",
    color: "#f59e0b",
    desc: "'ê¸°ê³„ê°€ ë§í•˜ëŠ”' ì²­êµ¬ ê·¼ê±° ìë™ ìƒì„±",
    steps: ["ëˆ„ì  ì´ë ¥ ê¸°ë°˜ ë¦¬í¬íŠ¸ ìƒì„±", "ì´ˆê³¼ í•­ëª© ëª©ë¡í™”", "ì˜ˆìƒ ì¶”ê°€ ë¹„ìš© ì‚°ì¶œ", "ê³µìœ ìš© PDF/ë§í¬ ì¶œë ¥"],
  },
  {
    id: "dashboard",
    label: "ì†ìµ ëŒ€ì‹œë³´ë“œ",
    icon: "ğŸ“Š",
    color: "#10b981",
    desc: "í”„ë¡œì íŠ¸ë³„ ì‹¤ì œ ì†ìµ ê°€ì‹œí™”",
    steps: ["í”„ë¡œì íŠ¸ë³„ ìˆ˜ìµ í˜„í™©", "ì²­êµ¬ ì„±ê³µ/ì‹¤íŒ¨ ì¶”ì ", "ì›”ë³„ ì†ìµ ì¶”ì´ ì°¨íŠ¸", "íŒ€ ì„±ê³¼ ìš”ì•½"],
  },
];

const flows = [
  { from: "onboarding", to: "daily", label: "í”„ë¡œì íŠ¸ ì…‹ì—… ì™„ë£Œ" },
  { from: "daily", to: "analysis", label: "ìš”ì²­ ë°œìƒ ì‹œ" },
  { from: "analysis", to: "report", label: "ì´ˆê³¼ íŒì • ì‹œ" },
  { from: "report", to: "dashboard", label: "ì²­êµ¬ ì‹œë„ í›„" },
  { from: "daily", to: "dashboard", label: "ë²”ìœ„ ë‚´ ìš”ì²­" },
];

const personas = [
  { role: "ì—ì´ì „ì‹œ PM", icon: "ğŸ‘©â€ğŸ’¼", path: ["onboarding", "daily", "analysis", "report", "dashboard"] },
  { role: "ëŒ€í‘œ (PM ê²¸ì§)", icon: "ğŸ¢", path: ["onboarding", "dashboard", "report"] },
];

export default function App() {
  const [activeScreen, setActiveScreen] = useState(null);
  const [activePersona, setActivePersona] = useState(null);
  const [mode, setMode] = useState("flow"); // flow | persona

  const isHighlighted = (id) => {
    if (!activePersona) return true;
    return activePersona.path.includes(id);
  };

  const isFlowActive = (f) => {
    if (!activePersona) return false;
    const p = activePersona.path;
    return p.includes(f.from) && p.includes(f.to);
  };

  return (
    <div style={{ background: "#0f1117", minHeight: "100vh", color: "#e8eaf0", fontFamily: "'Apple SD Gothic Neo', 'Pretendard', sans-serif", padding: "0" }}>
      {/* Header */}
      <div style={{ padding: "18px 24px 14px", borderBottom: "1px solid #1e2533", display: "flex", alignItems: "center", justifyContent: "space-between", flexWrap: "wrap", gap: 10 }}>
        <div>
          <span style={{ fontSize: 16, fontWeight: 800 }}><span style={{ color: "#4f80ff" }}>Scope</span>Manager</span>
          <span style={{ fontSize: 11, color: "#5a6478", marginLeft: 10 }}>í™”ë©´ í”Œë¡œìš° ë§µ</span>
        </div>
        <div style={{ display: "flex", gap: 6 }}>
          {["flow", "persona"].map(m => (
            <button key={m} onClick={() => { setMode(m); setActivePersona(null); setActiveScreen(null); }}
              style={{ padding: "5px 14px", borderRadius: 6, fontSize: 11, fontWeight: 700, cursor: "pointer", border: "1px solid", borderColor: mode === m ? "#4f80ff" : "#2e3748", background: mode === m ? "#4f80ff" : "none", color: mode === m ? "#fff" : "#8c95aa", transition: ".15s" }}>
              {m === "flow" ? "ğŸ—º í”Œë¡œìš°" : "ğŸ‘¤ í˜ë¥´ì†Œë‚˜"}
            </button>
          ))}
        </div>
      </div>

      {/* Persona selector */}
      {mode === "persona" && (
        <div style={{ padding: "14px 24px", borderBottom: "1px solid #1e2533", display: "flex", gap: 10, flexWrap: "wrap" }}>
          <span style={{ fontSize: 11, color: "#5a6478", alignSelf: "center" }}>í˜ë¥´ì†Œë‚˜ ì„ íƒ:</span>
          {personas.map(p => (
            <button key={p.role} onClick={() => setActivePersona(activePersona?.role === p.role ? null : p)}
              style={{ padding: "6px 16px", borderRadius: 20, fontSize: 12, fontWeight: 700, cursor: "pointer", border: "1px solid", borderColor: activePersona?.role === p.role ? "#4f80ff" : "#2e3748", background: activePersona?.role === p.role ? "rgba(79,128,255,.15)" : "none", color: activePersona?.role === p.role ? "#4f80ff" : "#8c95aa", transition: ".15s" }}>
              {p.icon} {p.role}
            </button>
          ))}
          {activePersona && (
            <span style={{ fontSize: 11, color: "#5a6478", alignSelf: "center", marginLeft: 4 }}>
              â†’ ì‚¬ìš© í™”ë©´: <span style={{ color: "#4f80ff" }}>{activePersona.path.length}ê°œ</span>
            </span>
          )}
        </div>
      )}

      {/* Main flow */}
      <div style={{ padding: "28px 24px 16px", overflowX: "auto" }}>
        {/* Flow diagram */}
        <div style={{ display: "flex", alignItems: "center", gap: 0, minWidth: 900, marginBottom: 32 }}>
          {screens.map((s, i) => (
            <>
              {/* Screen node */}
              <div key={s.id} onClick={() => setActiveScreen(activeScreen === s.id ? null : s.id)}
                style={{
                  flex: "0 0 160px", background: activeScreen === s.id ? "#1e2840" : "#1a1f2e",
                  border: `2px solid ${activeScreen === s.id ? s.color : isHighlighted(s.id) ? s.color + "60" : "#232b3e"}`,
                  borderRadius: 12, padding: "16px 14px", cursor: "pointer",
                  opacity: isHighlighted(s.id) ? 1 : 0.3,
                  transition: ".2s",
                  boxShadow: activeScreen === s.id ? `0 0 0 3px ${s.color}30` : "none",
                  borderTop: `4px solid ${s.color}`,
                  position: "relative",
                }}>
                <div style={{ fontSize: 24, marginBottom: 8 }}>{s.icon}</div>
                <div style={{ fontSize: 11, fontWeight: 700, color: s.color, letterSpacing: 1, marginBottom: 4 }}>SCREEN 0{i + 1}</div>
                <div style={{ fontSize: 14, fontWeight: 800, color: "#fff", marginBottom: 6 }}>{s.label}</div>
                <div style={{ fontSize: 11, color: "#8c95aa", lineHeight: 1.5 }}>{s.desc}</div>
                {activePersona && activePersona.path.includes(s.id) && (
                  <div style={{ position: "absolute", top: 8, right: 8, width: 8, height: 8, borderRadius: "50%", background: s.color }} />
                )}
              </div>
              {/* Arrow */}
              {i < screens.length - 1 && (
                <div key={`arrow-${i}`} style={{ flex: "0 0 40px", display: "flex", flexDirection: "column", alignItems: "center", gap: 3, opacity: isHighlighted(screens[i].id) && isHighlighted(screens[i + 1].id) ? 1 : 0.2 }}>
                  <div style={{ width: "100%", height: 2, background: "linear-gradient(90deg, #2e3748, #4f80ff50)", position: "relative" }}>
                    <div style={{ position: "absolute", right: -4, top: -5, fontSize: 12, color: "#4f80ff" }}>â–¶</div>
                  </div>
                  <div style={{ fontSize: 9, color: "#5a6478", textAlign: "center", lineHeight: 1.3 }}>
                    {flows.find(f => f.from === screens[i].id && f.to === screens[i + 1].id)?.label}
                  </div>
                </div>
              )}
            </>
          ))}
        </div>

        {/* Branch flow note */}
        <div style={{ background: "#1a1f2e", border: "1px solid #232b3e", borderRadius: 10, padding: "14px 18px", marginBottom: 24, display: "flex", alignItems: "flex-start", gap: 16, flexWrap: "wrap" }}>
          <span style={{ fontSize: 11, color: "#5a6478", fontWeight: 700, whiteSpace: "nowrap", marginTop: 2 }}>ğŸ”€ ë¶„ê¸° íë¦„</span>
          {flows.map((f, i) => {
            const from = screens.find(s => s.id === f.from);
            const to = screens.find(s => s.id === f.to);
            const active = isFlowActive(f);
            return (
              <div key={i} style={{ display: "flex", alignItems: "center", gap: 6, opacity: activePersona ? (active ? 1 : 0.25) : 1 }}>
                <span style={{ fontSize: 11, color: from.color, fontWeight: 700 }}>{from.icon} {from.label}</span>
                <span style={{ fontSize: 11, color: "#5a6478" }}>â†’</span>
                <span style={{ fontSize: 11, color: to.color, fontWeight: 700 }}>{to.icon} {to.label}</span>
                <span style={{ fontSize: 10, color: "#3a4258", background: "#1e2533", borderRadius: 4, padding: "1px 6px" }}>{f.label}</span>
              </div>
            );
          })}
        </div>

        {/* Detail panel */}
        {activeScreen && (() => {
          const s = screens.find(x => x.id === activeScreen);
          return (
            <div style={{ background: "#1a1f2e", border: `1px solid ${s.color}40`, borderLeft: `4px solid ${s.color}`, borderRadius: 10, padding: "18px 20px", marginBottom: 20 }}>
              <div style={{ display: "flex", alignItems: "center", gap: 10, marginBottom: 14 }}>
                <span style={{ fontSize: 24 }}>{s.icon}</span>
                <div>
                  <div style={{ fontSize: 15, fontWeight: 800, color: "#fff" }}>{s.label}</div>
                  <div style={{ fontSize: 12, color: "#8c95aa" }}>{s.desc}</div>
                </div>
              </div>
              <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
                {s.steps.map((step, i) => (
                  <div key={i} style={{ display: "flex", alignItems: "center", gap: 8, background: "#0f1117", borderRadius: 8, padding: "8px 12px", border: `1px solid ${s.color}30` }}>
                    <div style={{ width: 20, height: 20, borderRadius: "50%", background: s.color, display: "flex", alignItems: "center", justifyContent: "center", fontSize: 10, fontWeight: 800, color: "#fff", flexShrink: 0 }}>{i + 1}</div>
                    <span style={{ fontSize: 12, color: "#c5cbd8" }}>{step}</span>
                  </div>
                ))}
              </div>
            </div>
          );
        })()}

        {/* Core metrics row */}
        <div style={{ display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: 10, marginTop: 8 }}>
          {[
            { label: "í•µì‹¬ ì§€í‘œ 01", val: "ì²­êµ¬ ì‹œë„ ê±´ìˆ˜", color: "#4f80ff", icon: "ğŸ“ˆ" },
            { label: "í•µì‹¬ ì§€í‘œ 02", val: "ì¼ ì…ë ¥ ì™„ë£Œìœ¨", color: "#a855f7", icon: "ğŸ”" },
            { label: "í•µì‹¬ ì§€í‘œ 03", val: "ì´ˆê³¼ ê°ì§€ ê±´ìˆ˜/ì›”", color: "#06b6d4", icon: "ğŸ”" },
            { label: "í•µì‹¬ ì§€í‘œ â˜…", val: "ì²­êµ¬ ì„±ê³µë¥ ", color: "#10b981", icon: "â­" },
          ].map((m, i) => (
            <div key={i} style={{ background: "#1a1f2e", border: `1px solid ${m.color}30`, borderTop: `3px solid ${m.color}`, borderRadius: 8, padding: "12px 14px" }}>
              <div style={{ fontSize: 18, marginBottom: 4 }}>{m.icon}</div>
              <div style={{ fontSize: 9, fontWeight: 700, letterSpacing: 1, color: m.color, marginBottom: 4 }}>{m.label}</div>
              <div style={{ fontSize: 13, fontWeight: 700, color: "#fff" }}>{m.val}</div>
            </div>
          ))}
        </div>

        <div style={{ marginTop: 16, fontSize: 11, color: "#3a4258", textAlign: "right" }}>
          í™”ë©´ì„ í´ë¦­í•˜ë©´ ì„¸ë¶€ ìŠ¤í…ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ Â· í˜ë¥´ì†Œë‚˜ ëª¨ë“œì—ì„œ ì‚¬ìš© ê²½ë¡œë¥¼ í™•ì¸í•˜ì„¸ìš”
        </div>
      </div>
    </div>
  );
}
